<div class="video-product-section">
  
  <div class="video-product-section-title-wrapper">
      <h2 class="section-title">{{ section.settings.heading }}</h2>
      <p class="section-sub">{{ section.settings.subheading }}</p>
  </div>

  
  <div class="product-slider-center">
    {% for block in section.blocks %}
      <div class="product-card">
        <div class="product-image video-wrapper" style="position:relative;">
          
          <video class="product-video" loop muted playsinline>
            <source src="{{ block.settings.video_url }}" type="video/mp4">
          </video>
          <button class="video-control" aria-label="Toggle sound">
            <svg class="mute-icon" width="21" height="17" viewBox="0 0 21 17" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11.0536 1.00739C11.2434 1.09699 11.4048 1.23735 11.5198 1.41295C11.6349 1.58855 11.6992 1.79254 11.7055 2.00238V15.1676C11.7055 15.613 11.4307 15.9902 11.0553 16.195C10.857 16.2813 10.6379 16.3079 10.4248 16.2715C10.2117 16.2351 10.0139 16.1374 9.85548 15.9902L5.22359 11.8737H2.92642C2.63711 11.8776 2.34996 11.8235 2.08192 11.7146C1.81387 11.6057 1.57037 11.4442 1.36578 11.2396C1.1612 11.035 0.999676 10.7915 0.89076 10.5235C0.781844 10.2554 0.72774 9.96827 0.731642 9.67896V7.48419C0.731642 6.2844 1.69079 5.28942 2.92642 5.28942H5.22359L9.85378 1.21219C10.0121 1.06502 10.21 0.967258 10.4231 0.930881C10.6362 0.894503 10.8553 0.921092 11.0536 1.00739ZM15.3066 5.53176L17.1924 7.41934L19.0783 5.53176C19.3855 5.22456 19.9026 5.22456 20.2098 5.53176C20.5529 5.8748 20.5529 6.38851 20.2098 6.69742L18.324 8.58499L20.2115 10.4691C20.5546 10.8122 20.5546 11.3259 20.2115 11.6348C20.1411 11.7156 20.0541 11.7803 19.9565 11.8247C19.8589 11.869 19.753 11.892 19.6458 11.892C19.5386 11.892 19.4326 11.869 19.335 11.8247C19.2375 11.7803 19.1505 11.7156 19.08 11.6348L17.1924 9.74894L15.3083 11.6365C14.9652 11.9795 14.4515 11.9795 14.1426 11.6365C13.7996 11.3259 13.7996 10.8122 14.1426 10.4691L16.0285 8.58328L14.1375 6.69912C13.7962 6.39192 13.7962 5.87651 14.1375 5.53347C14.4481 5.22627 14.9618 5.22627 15.3049 5.53347L15.3066 5.53176Z" fill="white"/>
            </svg>
            <svg class="unmute-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11 5L6 9H2V15H6L11 19V5Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path class="sound-wave" d="M19.07 4.93C20.9447 6.80528 21.9979 9.34836 22 12C22 14.6522 20.9464 17.1957 19.07 19.07M15.54 8.46C16.4774 9.39764 17.0039 10.6692 17.0039 12C17.0039 13.3308 16.4774 14.6024 15.54 15.54" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
          <button class="video-play-pause" aria-label="Play/Pause video" style="position:absolute; bottom:20px; left:20px; width:40px; height:40px; border-radius:50%; background:none; border:none; display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:3; transition:all 0.3s ease;">
            <svg class="play-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <polygon points="6,4 20,12 6,20" fill="white"/>
            </svg>
            <svg class="pause-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display:none;">
              <rect x="6" y="4" width="4" height="16" fill="white"/>
              <rect x="14" y="4" width="4" height="16" fill="white"/>
            </svg>
          </button>
          <button class="zoom-btn" aria-label="Zoom video">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 3H21V9M9 21H3V15M21 3L14 10M3 21L10 14" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        {% assign ProductBlock = all_products[block.settings.product] %}
        <div class="product-card-small">
          <div class="small-card-content">
            <div class="small-product-image">
              <img
                src="{{ ProductBlock.featured_image | img_url: 'master' }}"
                alt="Product Thumbnail"
                width="68"
                height="84"
              >
            </div>
            <div class="small-product-details">
              <h4 class="small-product-title">
                  <a href="{{ ProductBlock.url }}" title="{{ ProductBlock.title }}">
                      {{ ProductBlock.title }}
                  </a>
              </h4>
              <div class="small-price-wrapper">
                {% if ProductBlock.compare_at_price > ProductBlock.price %}
                  <span class="small-compare-price">{{ ProductBlock.compare_at_price | money }}</span>
                {% endif %}
                <span class="small-product-price">{{ ProductBlock.price | money }}</span>
              </div>
            </div>
            <a href="{{ ProductBlock.url }}" class="add-to-cart-btn" aria-label="Add to cart">
              {{- 'icon-plus-cart.svg' | inline_asset_content -}}
            </a>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div> 

<div class="video-popup">
  <div class="popup-content">
    <button class="popup-close">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18M6 6L18 18" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
    <video class="popup-video" loop muted playsinline>
      <source src="" type="video/mp4">
    </video>
  </div>
</div>

<style>
    .video-product-section {
      padding: 60px 0;
      background-color: {{ section.settings.bg_color }};
      overflow: hidden;
    }

    .video-product-section-title-wrapper {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 6rem 1rem;
        @media only screen and (max-width: 749px) {
            padding: 0 6rem 2.8rem;
            flex-direction: column;
            gap: 0;
        }
    }

    .video-product-section-title-wrapper .section-sub {
        color: #000;
        margin: 0;
        line-height: 1;
        @media only screen and (max-width: 749px) {
            font-size: 13px;
        }
    }

    .video-product-section .section-title {
      font-size: 44px;
      line-height: 1;
      text-align: left;
      margin-bottom: 0;
      text-transform: uppercase;
      margin-top: 0;
      color: #000;
      @media only screen and (max-width: 749px) {
          font-size: 24px !important;
          margin-bottom: 9px !important;
          line-height: 31px !important;
      }
    }

    .video-product-section .product-slider-center {
      display: flex;
      gap: 24px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .video-product-section .product-card {
      flex: 1 1 300px;
      max-width: 350px;
      min-width: 250px;
      box-sizing: border-box;
      margin: 0 8px;
      border: 1px solid black;
      padding: 0;
      transition: all 0.5s ease;
      background: #fff;
      position: relative;
      display: flex;
      flex-direction: column;
    }
    .video-product-section .product-image.video-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 9/16;
      background: #000;
      overflow: hidden;
    }
    .video-product-section .product-video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      background: #000;
    }
   .video-product-section .video-control {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: none;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 3;
      transition: all 0.3s ease;
    }

    .video-product-section .video-control:hover {
      background: none;
      transform: scale(1.1);
    }

    .video-product-section .video-control svg {
      width: 24px;
      height: 24px;
      color: #000;
    }
    .video-product-section .video-play-pause,
    .video-product-section .video-mute-unmute,
    .video-product-section .video-popup-open {
      outline: none;
    }
    .video-popup-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.8);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }
    .video-popup-overlay.active {
      display: flex !important;
    }
    .video-popup-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
    }
    .video-popup-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      z-index: 2;
      cursor: pointer;
      font-size: 2rem;
      color: #fff;
    }
    .video-popup-video {
      max-width: 100%;
      max-height: 80vh;
      display: block;
      background: #000;
    }
    @media (max-width: 1024px) {
      .video-product-section .product-card {
        max-width: 90vw;
      }
    }

    .video-product-section .product-card-small {
        position: relative;
        background: #fff;
        padding: 6px 17px 6px 6px;
        margin-top: 0;
        box-shadow: none;
        transition: all 0.3s ease;
    }

    .video-product-section .small-card-content {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .video-product-section .small-product-image {
      width: 68px;
      height: 84px;
    }

    .video-product-section .small-product-image img {
        width: auto;
        height: 100%;
    }

    .video-product-section .small-product-details {
      flex-grow: 1;
      min-width: 0;
    }

    .video-product-section .small-product-title {
        font-size: 1.4rem;
        font-weight: 400;
        margin: 0 0 7px;
        font-family: 'Helvetica';
        line-height: normal;
    }

    .video-product-section .small-product-title a {
        color: #000;
        text-decoration: none;
    }

    .video-product-section .small-price-wrapper {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .video-product-section .small-compare-price {
      font-size: 1.4rem;
      color: #989898;
      text-decoration: line-through;
      line-height: 21px;
    }

    .video-product-section .small-product-price {
        font-size: 1.4rem;
        color: #000;
        line-height: normal;
    }

    .video-product-section .add-to-cart-btn {
      border-radius: 50%;
      background: #fff;
      border: none;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      flex-shrink: 0;
      transition: all 0.3s ease;
      padding: 0;
    }

    .video-product-section .slick-slide {
        transition: all 0.3s ease;
    }

    .video-product-section .slick-current {
      z-index: 2;
    }

    .video-product-section .slick-current .product-info {
      opacity: 1;
      transform: translateY(0);
    }

    @media screen and (max-width: 767px) {
      .video-product-section .section-title {
          font-size: 26px;
          margin-bottom: 42px;
          line-height: 31px;
      }
      .video-product-section .product-video {
        max-height: 350px;
      }
      .video-product-section .slick-center .product-image .product-video {
          max-height: 470px;
      }
      .video-product-section .product-title {
        font-size: 1.4rem;
      }

      .video-product-section .compare-price {
        font-size: 1.2rem;
      }

      .video-product-section .product-price {
        font-size: 1.6rem;
      }


      .video-product-section {
          padding: 36px 0 50px;
          margin-bottom: 0;
      }
       
      .video-product-section .product-card-small {
    margin-top: 0;
}
      .video-product-section .product-card-small {
    margin-top: 0;
    padding: 4px 7px 4px 4px;
}
      .video-product-section .slick-center .small-product-image {
    width: 52px;
    height: 64px;
}
      .video-product-section .small-card-content {
        gap : 8px;
      }
      .video-product-section .small-product-title {
    font-size: 11px;
    line-height: 16px;
        margin-bottom: 3px;
}
      .video-product-section .small-product-price,
      .video-product-section .small-compare-price{
    font-size: 10px;
    line-height: 15px;
}
      .video-product-section .product-card {
        padding: 0;
      }
    }

  @media only screen and (max-width: 1600px) {
      .video-product-section .slick-current img.product-video {
          height: 600px;
      }
  }

  @media only screen and (max-width: 1440px) {
      .video-product-section .slick-current img.product-video {
          height: 500px;
      }
  }

  @media only screen and (max-width: 1380px) {
      .video-product-section .slick-current img.product-video {
          height: 450px;
      }
  }

  @media only screen and (max-width: 1300px) {
      .video-product-section .slick-current img.product-video {
          height: 440px;
      }
  }

  @media only screen and (max-width: 1200px) {
      .video-product-section .slick-current img.product-video {
          height: 350px;
      }
  }

  @media only screen and (max-width: 1024px) {
      .video-product-section .slick-current img.product-video {
          height: 510px;
      }
  }


  @media only screen and (max-width: 920px) {
    .video-product-section .slick-current img.product-video {
      height: 1200px;
    }
  }

  @media only screen and (max-width: 500px) {
    .video-product-section .slick-current img.product-video {
      height: 390px;
    }
  }

  @media only screen and (max-width: 749px) {
      .video-product-section .slick-dots {
          position: relative;
          bottom: 0;
          margin-top: 20px;
          li {
              width: auto;
              height: auto;
              margin: 0;
              button {
                  padding: 0;
                  height: 2px;
                  width: 50px;
                  background: #C5C5C5;
                  &:before {
                      display: none;
                  }
              }
              &.slick-active {
                  button {
                      background: #000000;
                  }
              }
          }
      }
  }

  .zoom-btn {
  position: absolute;
  top: 15px;
  right: 14px;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  background: transparent;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 3;
  opacity: 0;
  transition: all 0.3s ease;
}

.slick-center .zoom-btn {
  opacity: 1;
}

.zoom-btn:hover {
  transform: scale(1.1);
  background: rgba(0, 0, 0, 0.7);
}

.zoom-btn svg {
  width: 24px;
  height: 24px;
}

.video-popup {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.9);
  z-index: 999999;
  display: none;
  justify-content: center;
  align-items: center;
}

.video-popup.active {
  display: flex;
}

.popup-content {
  position: relative;
  width: 90%;
  height: 90%;
  max-width: 1200px;
}

.popup-video {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.popup-close {
  position: absolute;
  top: -40px;
  right: 0;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  background: rgba(0, 0, 0, 0.5);
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.popup-close:hover {
  transform: scale(1.1);
  background: rgba(0, 0, 0, 0.7);
}

.popup-close svg {
  width: 24px;
  height: 24px;
}

@media screen and (max-width: 767px) {
  .zoom-btn {
    width: 36px;
    height: 36px;
    top: 15px;
    right: 15px;
  }

  .zoom-btn svg {
    width: 20px;
    height: 20px;
  }

  .popup-close {
    width: 36px;
    height: 36px;
    top: -36px;
  }

  .popup-close svg {
    width: 20px;
    height: 20px;
  }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
  // Fix: Ensure videos inside Slick load correctly on init
    jQuery('.product-slider-center').on('init', function (event, slick) {
      const videos = document.querySelectorAll('.product-video');
      videos.forEach(video => {
        video.load(); // Force rendering of video
      });

      // Trigger resize to force repaint (especially on Safari)
      setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
      }, 100);
    });
    // Initialize Slick
    jQuery('.product-slider-center').slick({
      centerMode: false,
      centerPadding: '350px',
      slidesToShow: {{ section.settings.slide_show_desktop }},
      speed: 100,
      autoplay: false,
      autoplaySpeed: 1500,
      arrows: false,
      dots: false,
      responsive: [
        {
          breakpoint: 1600,
          settings: {
            centerPadding: '275px',
            slidesToShow: {{ section.settings.slide_show_desktop }},
          },
        },
        {
          breakpoint: 1300,
          settings: {
            centerPadding: '220px',
            slidesToShow: {{ section.settings.slide_show_desktop }},
          },
        },
        {
          breakpoint: 1024,
          settings: {
            slidesToShow: 3,
            centerPadding: '60px',
          },
        },
        {
          breakpoint: 920,
          settings: {
            slidesToShow: {{ section.settings.slide_show_mobile }},
            centerPadding: '100px',
          },
        },
        {
          breakpoint: 768,
          settings: {
            slidesToShow: {{ section.settings.slide_show_mobile }},
            centerPadding: '100px',
            dots: true
          },
        },
        {
          breakpoint: 640,
          settings: {
            slidesToShow: {{ section.settings.slide_show_mobile }},
            centerPadding: '80px',
            dots: true
          },
        },
      ],
    });
 // Video mute/unmute control
    const cards = document.querySelectorAll('.product-card');
    cards.forEach((card) => {
      const video = card.querySelector('.product-video');
      const muteControl = card.querySelector('.video-control');
      const muteIcon = card.querySelector('.mute-icon');
      const unmuteIcon = card.querySelector('.unmute-icon');

      if (muteControl) {
        muteIcon.style.display = video.muted ? 'block' : 'none';
        unmuteIcon.style.display = video.muted ? 'none' : 'block';

        muteControl.addEventListener('click', (e) => {
          e.preventDefault();
          video.muted = !video.muted;
          muteIcon.style.display = video.muted ? 'block' : 'none';
          unmuteIcon.style.display = video.muted ? 'none' : 'block';
        });
      }
    });

    // Video play/pause control
    cards.forEach((card) => {
      const video = card.querySelector('.product-video');
      const playPauseBtn = card.querySelector('.video-play-pause');
      const playIcon = playPauseBtn.querySelector('.play-icon');
      const pauseIcon = playPauseBtn.querySelector('.pause-icon');

      // Set initial state
      playIcon.style.display = video.paused ? 'block' : 'none';
      pauseIcon.style.display = video.paused ? 'none' : 'block';

      playPauseBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (video.paused) {
          video.play();
          playIcon.style.display = 'none';
          pauseIcon.style.display = 'block';
        } else {
          video.pause();
          playIcon.style.display = 'block';
          pauseIcon.style.display = 'none';
        }
      });

      // Update icons if user uses native controls or other triggers
      video.addEventListener('play', () => {
        playIcon.style.display = 'none';
        pauseIcon.style.display = 'block';
      });
      video.addEventListener('pause', () => {
        playIcon.style.display = 'block';
        pauseIcon.style.display = 'none';
      });
    });

    // Video popup functionality
    const popup = document.querySelector('.video-popup');
    const popupVideo = popup.querySelector('.popup-video');
    const closeBtn = popup.querySelector('.popup-close');

    document.addEventListener('click', function (e) {
      if (e.target.closest('.zoom-btn')) {
        const card = e.target.closest('.product-card');
        const video = card.querySelector('.product-video');
        const videoSource = video.querySelector('source').src;

        popupVideo.querySelector('source').src = videoSource;
        popupVideo.load();
        popupVideo.play();
        popup.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
    });

    closeBtn.addEventListener('click', function () {
      popupVideo.pause();
      popup.classList.remove('active');
      document.body.style.overflow = '';
    });

    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape' && popup.classList.contains('active')) {
        popupVideo.pause();
        popup.classList.remove('active');
        document.body.style.overflow = '';
      }
    });
  });
</script>

{% schema %}
{
  "name": "Inspired CTM",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Sub Heading"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color"
    },
    {
      "type": "range",
      "id": "slide_show_desktop",
      "min": 3,
      "max": 12,
      "step": 1,
      "default": 3,
      "label": "Slide Show for Desktop"
    },
    {
      "type": "range",
      "id": "slide_show_mobile",
      "min": 1,
      "max": 12,
      "step": 1,
      "default": 1,
      "label": "Slide Show for Mobile"
    }
  ],
  "blocks": [
    {
      "type": "video_section",
      "name": "Add Image",
      "settings": [
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL",
          "info": "Upload the video in backend files option and use that URL over here"
        },
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Inspired CTM"
    }
  ]
}
{% endschema %}
